<div class="userpage" style="background-color:<%= @username.userstyle.page_background_color %>">

<% @userpage = true %>
<h2>User Page</h2>
<h1><%= @username.name %></h1>
<h2><%= button_to "Archive", archive_path(@username.name), method: :get %></h2>
<h2><%= button_to "Gallery", gallery_path(@username.name), method: :get %></h2>
<p><%= @username.profile %></p>
<% if logged_in? %>
<% if @username.user == @current_user %>
<div class="styleform">
  <h2>Edit your post styles</h2>
<%= simple_form_for([@username, @username.userstyle]) do |f| %>
<%= f.input :post_text_color, require: true, as: :minicolors %><br>
<%= f.input :post_background_color, require: true, as: :minicolors %><br>
<%= f.input :page_background_color, require: true, as: :minicolors %><br>
    <%= f.label 'Signature Text' %><%= f.text_field :signature %><br>
      <%= f.label 'Custom CSS for Signature' %><%= f.text_field :signature_css %><%= link_to "What's CSS and how do I use it?", css_path %><br>
    <%= f.submit 'Set styles' %>
    <% end %>
  </div>
  <% else %>
  <div class="styleform">
    <% if logged_in? %>
    <% if @current_user.usernames.find_by(default: true).follows.where(recipient_id: @username.id) == nil %>
    <% names = ["(Default) " + @current_user.usernames.find_by(default: true).name] %>
    <% ids = [@current_user.usernames.find_by(default: true).id] %>
    <% else %>
    <% names = [] %>
    <% ids = [] %>
    <% end %>
      <% @current_user.usernames.each do |u| %>
        <% if !u.follows.where(recipient_id: @username.id).exists? %>
        <% names.push u.name %>
        <% end %>
      <% end %>
      <% @current_user.usernames.each do |u| %>
        <% if !u.follows.where(recipient_id: @username.id).exists? %>
        <% ids.push u.id %>
        <% end %>
      <% end %>
      <% @username_selector = names.zip(ids) %>
    <% end %>

    <% if @current_user.usernames.present? && @username_selector != [] %>
    Follow user as
    <% @your_username = @current_user.usernames.find_by(default: true) %>
    <%= form_for([@your_username, Follow.new]) do |f| %>
    <%= f.hidden_field :recipient_id, value: @username.id %>
    <%= f.select :username_id, options_for_select(@username_selector) %>
    <%= f.text_field :body, placeholder: 'Message', required: true %>
    <%= f.submit("Follow") %> ?
    <% end %>
      <% end %>
<% @current_user.usernames.each do |us| %>
<% us.follows.each do |fo| %>
<% if fo.recipient_id == @username.id %>
<br>You follow this user as <%= us.name %>
<% end %>
<% end %>
<% end %>

  </div>
<% end %>

<% end %>
<% @posts = @username.posts %>
<%= render 'layouts/post' %>
</div>
